# ä¸‰åˆ†é’Ÿæ‹¥æœ‰è‡ªå·±çš„ ChatGPT (ä»å¼€å‘åˆ°ä¸Šçº¿) 

OpenAI å·²ç»å…¬å¸ƒäº† ChatGPT æ­£å¼ç‰ˆ APIï¼ŒèƒŒåçš„æ–°æ¨¡å‹æ˜¯ gpt-3.5-turboï¼Œè¿™æ˜¯ OpenAI ç›®å‰æœ€å…ˆè¿›çš„æ¨¡å‹ï¼Œå“åº”é€Ÿåº¦æ›´å¿«ï¼Œä»·æ ¼æ›´ä¾¿å®œã€‚

ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›é€šè¿‡ API å°† ChatGPT å’Œç›¸å…³æ¨¡å‹é›†æˆåˆ°è‡ªå·±çš„äº§å“å’Œåº”ç”¨ä¸­ï¼Œå°´å°¬çš„æ˜¯ï¼Œç›®å‰æ— æ³•è®¿é—® ChatGPT APIï¼ŒåŸå› å¤§å®¶éƒ½æ‡‚å¾—ã€‚äºæ˜¯ç½‘ä¸Šå‡ºç°äº†å„ç§å„æ ·çš„ API åä»£æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡åä»£æœåŠ¡æ¥å˜ç›¸è®¿é—® ChatGPT APIã€‚

å³ä½¿æˆ‘ä»¬è§£å†³äº† API çš„è®¿é—®é—®é¢˜ï¼Œè¿˜è¦å‡†å¤‡ä¸€ä¸ªå¼€å‘ç¯å¢ƒï¼Œæ¯”å¦‚å¯¹äº Node.js å®¢æˆ·ç«¯æ¥è¯´ï¼Œéœ€è¦å‡†å¤‡ä¸€ä¸ª Node.js ç¯å¢ƒã€‚

æœ‰æ²¡æœ‰ä¸€ç§ç®€å•å¿«æ·çš„æ–¹æ³•æ¥è°ƒç”¨ ChatGPT API å‘¢ï¼Ÿ

**é‚£å½“ç„¶æ˜¯ç”¨ Laf äº†ã€‚**

Laf æ˜¯ä¸€ä¸ª**å®Œå…¨å¼€æº**çš„ä¸€ç«™å¼äº‘å¼€å‘å¹³å°ï¼Œæä¾›äº†å¼€ç®±å³ç”¨çš„äº‘å‡½æ•°ï¼Œäº‘æ•°æ®åº“ï¼Œå¯¹è±¡å­˜å‚¨ç­‰èƒ½åŠ›ï¼Œè®©ä½ å¯ä»¥åƒå†™åšå®¢ä¸€æ ·å†™ä»£ç ã€‚

> GitHubï¼š**https://github.com/labring/laf**

å¦‚æœä½ å¸Œæœ›å¿«é€Ÿäº†è§£ Laf çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š[ä¸‰åˆ†é’Ÿå­¦ä¼š Laf](https://zuofeng59556.github.io/my-blog/pages/quickStart/laf/)ã€‚

è¨€å½’æ­£ä¼ ï¼Œ**ä¸‹é¢æˆ‘ä»¬å¼€å§‹è®¡æ—¶**ï¼Œä¸‰åˆ†é’Ÿæ—¶é—´ç”¨ Laf å®ç°ä¸€ä¸ªè‡ªå·±çš„ ChatGPTï¼

> å‰ææ¡ä»¶ï¼šä½ éœ€è¦å‡†å¤‡ä¸€ä¸ª ChatGPT è´¦å·å¹¶ä¸”ç”Ÿæˆä¸€ä¸ª API Key (è¿™ä¸€æ­¥å¯ä»¥é—® Google )

## äº‘å‡½æ•°æ•™å­¦

é¦–å…ˆéœ€è¦ç™»å½• [laf.dev](https://laf.dev)ï¼Œç„¶åæ–°å»ºä¸€ä¸ªåº”ç”¨ã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-22-YLijVo.png)

ç‚¹å‡»å¼€å‘æŒ‰é’®è¿›å…¥å¼€å‘é¡µé¢ã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-26-NMoDbR.png)

åœ¨ NPM ä¾èµ–é¢æ¿ä¸­ç‚¹å‡»å³ä¸Šè§’çš„ `+`ï¼š

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-09-23-29-wNbCOt.png)

ç„¶åè¾“å…¥ chatgpt å¹¶å›è½¦è¿›è¡Œæœç´¢ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªæœç´¢ç»“æœï¼Œ**ä¿å­˜å¹¶é‡å¯ï¼š**

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-09-23-30-ARz9Vu.png)

é‡å¯ä¹‹åï¼Œè‡ªå®šä¹‰ä¾èµ–é¡¹ä¸­ä¾¿å‡ºç°äº† chatgptã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-09-23-35-WoQaDj.png)

ç„¶åå°±å¯ä»¥åƒæˆ‘ä¸€æ ·æ–°å»ºä¸€ä¸ªäº‘å‡½æ•°åå­—å« **send**ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```typescript
import cloud from '@lafjs/cloud'
export async function main(ctx: FunctionContext) {
  const { ChatGPTAPI } = await import('chatgpt')
  const api = new ChatGPTAPI({ apiKey: cloud.env.CHAT_GPT_API_KEY })

  let res = await api.sendMessage('â€œé¸¡ä½ å¤ªç¾â€æŒ‡çš„æ˜¯ä¸­å›½å¤§é™†å“ªä½ç”·è‰ºäººï¼Ÿç»™ä½ ä¸ªæç¤ºï¼Œä»–å–œæ¬¢å”±ã€è·³ã€ç¯®çƒã€Rap')
  console.log(res.text)

  return res.text
}
```

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-36-kyCtdE.png)

API Key æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡ `CHAT_GPT_API_KEY` ä¼ å…¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ç‚¹å‡»å·¦ä¸‹è§’çš„è®¾ç½®å›¾æ ‡ï¼š

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-38-ydsD8h.png)

ä¾æ¬¡é€‰æ‹©ã€Œç¯å¢ƒå˜é‡ã€--> ã€Œæ–°å¢ç¯å¢ƒå˜é‡ã€ï¼Œè¾“å…¥ç¯å¢ƒå˜é‡çš„åç§°å’Œå€¼ï¼Œç„¶åç‚¹å‡»ã€Œç¡®å®šã€ï¼Œå†ç‚¹å‡»ã€Œæ›´æ–°ã€ï¼Œä¾¿ä¼šé‡å¯åº”ç”¨ã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-46-Hr7VTk.png)

ç°åœ¨ç‚¹å‡»å³ä¸Šè§’çš„ã€Œè¿è¡Œã€ï¼Œå³å¯è°ƒè¯•è¿è¡Œã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-49-44vRN2.png)

Perfectï¼ç°åœ¨æˆ‘ä»¬æ¥è¯•è¯•æ·»åŠ **è¿½è¸ªä¸Šä¸‹æ–‡**çš„åŠŸèƒ½ã€‚å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨å¯¹è¯æ—¶ä¼ å…¥ä¸Šä¸€æ¬¡å¯¹è¯çš„ ID å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

```typescript
import cloud from '@lafjs/cloud'
export async function main(ctx: FunctionContext) {
  const { ChatGPTAPI } = await import('chatgpt')
  const api = new ChatGPTAPI({ apiKey: cloud.env.CHAT_GPT_API_KEY })

  let res = await api.sendMessage('â€œé¸¡ä½ å¤ªç¾â€æŒ‡çš„æ˜¯ä¸­å›½å¤§é™†å“ªä½ç”·è‰ºäººï¼Ÿç»™ä½ ä¸ªæç¤ºï¼Œä»–å–œæ¬¢å”±ã€è·³ã€ç¯®çƒã€Rap')
  console.log(res.text)

  // ä¼ å…¥ parentMessageId è¿½è¸ªä¸Šä¸‹æ–‡
  res = await api.sendMessage('ä¸å¯¹ï¼Œä»–å§“è”¡ï¼Œè¯·é‡æ–°å›ç­”', {
    parentMessageId: res.id
  })
  console.log(res.text)

  return res.text
}
```

è¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼š

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-18-53-Vavw0w.png)

å¥½å‰å®³ï¼Œç«Ÿç„¶ä¸¤æ¬¡å°±ç­”å¯¹äº†æˆ‘çš„é—®é¢˜ï¼

å¥½äº†ï¼Œ**ç°åœ¨æ‰å¼€å§‹çœŸçš„è®¡æ—¶**ï¼Œå› ä¸ºåˆšåˆšæ˜¯æ•™å­¦ç¯èŠ‚ï¼Œä¸è®¡å…¥è€—æ—¶ğŸ˜

## äº‘å‡½æ•°

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åŠ¨æ‰‹æ‰“é€ è‡ªå·±çš„ ChatGPT äº†ï¼Œé¦–å…ˆæŠŠä¸Šä¸€èŠ‚çš„å‡½æ•°æ›¿æ¢ä¸ºä¸‹é¢çš„å†…å®¹ï¼š

```typescript
import cloud from '@lafjs/cloud'

export async function main(ctx: FunctionContext) {
  const { ChatGPTAPI } = await import('chatgpt')
  const data = ctx.body

  // è¿™é‡Œéœ€è¦æŠŠ api å¯¹è±¡æ”¾å…¥ cloud.shared ä¸ç„¶æ— æ³•è¿½è¸ªä¸Šä¸‹æ–‡
  let api = cloud.shared.get('api')
  if (!api) {
    api = new ChatGPTAPI({ apiKey: cloud.env.CHAT_GPT_API_KEY })
    cloud.shared.set('api', api)
  }

  let res
  // è¿™é‡Œå‰ç«¯å¦‚æœä¼ è¿‡æ¥ parentMessageId åˆ™ä»£è¡¨éœ€è¦è¿½è¸ªä¸Šä¸‹æ–‡
  if (!data.parentMessageId) {
    res = await api.sendMessage(data.message)
  } else {
    res = await api.sendMessage(data.message, { parentMessageId: data.parentMessageId })
  }
  return res
}
```

ç°åœ¨åº”è¯¥å¾ˆå¥½ç†è§£è¿™ä¸ªå‡½æ•°äº†å§ï¼Ÿ

## å‰ç«¯

æˆ‘ä»¬è¦å®ç°çš„æ˜¯ Web ç‰ˆ ChatGPTï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªå‰ç«¯é¡µé¢ã€‚é¦–å…ˆéœ€è¦å®‰è£… Laf çš„ SDKï¼š

```bash
$ npm install laf-client-sdk
```

æ¥ä¸‹æ¥ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª cloud å¯¹è±¡ï¼š

```typescript
import { Cloud } from "laf-client-sdk"; 

// åˆ›å»º cloud å¯¹è±¡ è¿™é‡Œéœ€è¦å°† <appid> æ›¿æ¢æˆè‡ªå·±çš„ App ID
const cloud = new Cloud({
  baseUrl: "https://<appid>.laf.dev",
  getAccessToken: () => "", // è¿™é‡Œä¸éœ€è¦æˆæƒï¼Œå…ˆå¡«ç©º
});
```

è¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å‰ç«¯çš„æ ¸å¿ƒä»£ç ï¼Œéå¸¸çš„ç®€å•ï¼Œå°±æ˜¯æŠŠæé—®çš„å†…å®¹å’Œä¸Šä¸‹æ–‡ id ä¼ å…¥äº‘å‡½æ•°å°±å¯ä»¥äº†ã€‚

```typescript
async function send() {

// æˆ‘ä»¬æé—®çš„å†…å®¹
const message = question.value;

let res;
// ä¸äº‘å‡½æ•°é€»è¾‘ä¸€æ ·ï¼Œæœ‰ä¸Šä¸‹æ–‡ id å°±ä¼ å…¥
if (!parentMessageId.value) {
  res = await cloud.invoke("send", { message });
} else {
  res = await cloud.invoke("send", { message, parentMessageId: parentMessageId.value });
}

// å›å¤æˆ‘ä»¬çš„å†…å®¹åœ¨ res.text 

// è¿™ä¸ªæ˜¯ä¸Šä¸‹æ–‡ id
parentMessageId.value = res.id;
}
```

åˆ°è¿™ä¸€æ­¥ æˆ‘ä»¬å·²ç»å¯ä»¥å‘ä¿¡æ¯ç»™ ChatGPT å¹¶ä¸”æ‹¿åˆ°å›å¤çš„æ¶ˆæ¯äº†ã€‚

æˆ‘ä»¬åªè¦ç¨å¾®åŠ **äº¿ç‚¹ç‚¹**ç»†èŠ‚ï¼Œå°±å¯ä»¥å˜æˆè¿™æ ·ï¼š

![alt å±æ€§æ–‡æœ¬](./image/3.png)   


åŠ å®Œè¿™ç‚¹ç»†èŠ‚ä¹‹åï¼ŒåŸºæœ¬å¼€å‘å·¥ä½œå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŠŠé¡¹ç›®ä¸Šçº¿åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œé¡ºä¾¿è£…ä¸ªæ¯ã€‚

è¯´åˆ°ä¸Šçº¿æˆ‘ä»¬ç°åœ¨åº”è¯¥è¦å»ä¹°ä¸€å°æœåŠ¡å™¨å®‰è£… Nginxï¼Œé…ç½® Nginxï¼Œè§£æåŸŸåï¼Œç»‘å®šåŸŸå...

**NO NO NO æˆ‘ä¸å…è®¸ä½ æµªè´¹å¹´è½»è€Œç¾å¥½çš„ç”Ÿå‘½ï¼Œlife is short, you need laf ğŸ˜ƒ**

## ä¸Šçº¿

æ‰“å¼€ä½ çš„ Lafï¼Œç‚¹å‡»å­˜å‚¨ç•Œé¢ --> ç‚¹å‡»ä¸Šæ–¹åŠ å· --> åˆ›å»ºä¸€ä¸ªæƒé™ä¸º readonly çš„å­˜å‚¨æ¡¶ï¼ˆåå­—éšæ„ï¼‰ã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-19-09-hMcqZu.jpg)

åˆ›å»ºå®Œä¹‹åï¼Œåœ¨ä½ çš„å‰ç«¯é¡¹ç›®ä¸­è¿è¡Œæ‰“åŒ…å‘½ä»¤ã€‚æˆ‘è¿™é‡Œç”¨çš„æ˜¯ `npm run build`ã€‚

æ‰“åŒ…å®Œæ¯•ä¹‹åæ‰¾åˆ°æ‰“åŒ…å¥½çš„ `dist` æ–‡ä»¶å¤¹ï¼Œåƒæˆ‘ä¸€æ ·æŠŠ `dist` æ–‡ä»¶é‡Œé¢çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¸Šä¼ åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„å­˜å‚¨æ¡¶é‡Œé¢ï¼Œè®°ä½æ˜¯åŸå°ä¸åŠ¨çš„ä¸Šä¼ å“¦ï¼Œæ–‡ä»¶å°±æ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹å°±æ˜¯æ–‡ä»¶å¤¹ã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-19-11-EE5Ld4.jpg)

ä¸Šä¼ å®Œæ¯•ä¹‹åï¼Œå‘ç°å³ä¸Šè§’æœ‰ä¸€ä¸ª â€œå¼€å¯ç½‘ç«™æ‰˜ç®¡â€ï¼Œç‚¹ä¸€ä¸‹å®ƒï¼

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-19-11-N0Ty0Z.jpg)

ç‚¹å®Œä¹‹åå‡ºæ¥ä¸€ä¸ªé“¾æ¥ï¼Œæˆ‘ä»¬ç‚¹å‡»ä¸€ä¸‹è®¿é—®çœ‹çœ‹æ˜¯å•¥ä¸œè¥¿ã€‚

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-19-12-iBZITq.jpg)

**å“¦ï¼æˆ‘çš„è€å¤©é¹…å‘€ è¿™ä¸å°±æ˜¯æˆ‘åˆšåˆšå¼€å‘çš„é¡¹ç›®å—ï¼Ÿï¼Ÿ**

![](https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting5@main/uPic/2023-03-11-19-12-bFGfCz.jpg)

æ­å–œï¼Œåˆ°è¿™é‡Œä½ çš„é¡¹ç›®å·²ç»ä¸Šçº¿äº†ï¼Œå¿«åˆ†äº«ç»™ä½ çš„å¥½æœ‹å‹å§ï¼

---

+ é¡¹ç›®æºç ï¼š**https://github.com/zuoFeng59556/chatGPT**
+ ç¤ºä¾‹ç½‘ç«™ï¼š**https://jyf6wk-chat-gpt.site.laf.dev/**

